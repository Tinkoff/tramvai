"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4942],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),s=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=s(e.components);return a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=s(n),m=r,h=u["".concat(c,".").concat(m)]||u[m]||d[m]||o;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},7691:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>c,default:()=>m,frontMatter:()=>l,metadata:()=>s,toc:()=>d});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),i=["components"],l={},c=void 0,s={unversionedId:"references/modules/dns-cache",id:"references/modules/dns-cache",title:"dns-cache",description:"DNS lookup cache for Node.js - cacheable-lookup library integration.",source:"@site/tmp-docs/references/modules/dns-cache.md",sourceDirName:"references/modules",slug:"/references/modules/dns-cache",permalink:"/docs/references/modules/dns-cache",draft:!1,editUrl:"https://github.com/Tinkoff/tramvai/-/edit/master/docs/get-started/overview.md/tmp-docs/references/modules/dns-cache.md",tags:[],version:"current",frontMatter:{},sidebar:"sidebar",previous:{title:"deps-graph",permalink:"/docs/references/modules/deps-graph"},next:{title:"env",permalink:"/docs/references/modules/env"}},p={},d=[{value:"Explanation",id:"explanation",level:2},{value:"Installation",id:"installation",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Enable/disable",id:"enabledisable",level:3},{value:"Cache TTL",id:"cache-ttl",level:3},{value:"Cache size",id:"cache-size",level:3}],u={toc:d};function m(e){var t=e.components,n=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"DNS lookup cache for Node.js - ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/szmarczak/cacheable-lookup"},"cacheable-lookup")," library integration."),(0,o.kt)("h2",{id:"explanation"},"Explanation"),(0,o.kt)("p",null,"DNS lookup cache can speed up your server-side HTTP requests to external API's."),(0,o.kt)("p",null,"Usually, DNS lookup is a fast process, but Node.js (",(0,o.kt)("inlineCode",{parentName:"p"},"libuv")," under the hood) has a ",(0,o.kt)("a",{parentName:"p",href:"https://nodejs.org/docs/latest-v18.x/api/cli.html#uv_threadpool_sizesize"},"default limit of 4 concurrent threads"),", used for a ",(0,o.kt)("a",{parentName:"p",href:"https://nodejs.org/en/docs/guides/dont-block-the-event-loop"},"set of synchronous operations"),", including DNS lookup, so lookup can be queued. Or if application is under high load, or while any network problems, DNS lookup time can be increased."),(0,o.kt)("p",null,"First main optimization of HTTP connections is already used in ",(0,o.kt)("inlineCode",{parentName:"p"},"tramvai")," ",(0,o.kt)("a",{parentName:"p",href:"/docs/features/data-fetching/http-client"},"HTTP clients")," - ",(0,o.kt)("a",{parentName:"p",href:"https://nodejs.org/api/http.html#new-agentoptions"},"keepAlive option")," for ",(0,o.kt)("inlineCode",{parentName:"p"},"http")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"https")," agents. With ",(0,o.kt)("inlineCode",{parentName:"p"},"keepAlive"),", TCP sockets are reused for multiple HTTP requests, and count of DNS lookups is decreased dramatically."),(0,o.kt)("p",null,"Because of that, DNS cache it's a nice and cheap optimization, but don't expect some huge performance boost."),(0,o.kt)("p",null,"Potential disadvantages - external services can change their IP addresses, and HTTP requests will use outdated DNS cache, you can detect some of this errors by search ",(0,o.kt)("inlineCode",{parentName:"p"},"ECONNRESET")," errors is server logs, so long cache TTL is not recommended."),(0,o.kt)("h2",{id:"installation"},"Installation"),(0,o.kt)("p",null,"You need to install ",(0,o.kt)("inlineCode",{parentName:"p"},"@tramvai/module-dns-cache")," module:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npx tramvai add @tramvai/module-dns-cache\n")),(0,o.kt)("p",null,"Then, connect ",(0,o.kt)("inlineCode",{parentName:"p"},"TramvaiDnsCacheModule")," from this package to ",(0,o.kt)("inlineCode",{parentName:"p"},"createApp")," function:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import { createApp } from '@tramvai/core';\nimport { TramvaiDnsCacheModule } from '@tramvai/module-dns-cache';\n\ncreateApp({\n  name: 'tincoin',\n  modules: [TramvaiDnsCacheModule],\n});\n")),(0,o.kt)("h2",{id:"configuration"},"Configuration"),(0,o.kt)("h3",{id:"enabledisable"},"Enable/disable"),(0,o.kt)("p",null,"By default, DNS lookup cache is ",(0,o.kt)("strong",{parentName:"p"},"enabled"),"."),(0,o.kt)("p",null,"To disable it, you need to provide ",(0,o.kt)("inlineCode",{parentName:"p"},"DNS_LOOKUP_CACHE_ENABLE")," environment variable:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"DNS_LOOKUP_CACHE_ENABLE=false\n")),(0,o.kt)("h3",{id:"cache-ttl"},"Cache TTL"),(0,o.kt)("p",null,"Default TTL for DNS lookup cache is 60 seconds. You can change it by providing ",(0,o.kt)("inlineCode",{parentName:"p"},"DNS_LOOKUP_CACHE_TTL")," environment variable:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"DNS_LOOKUP_CACHE_TTL=120000\n")),(0,o.kt)("h3",{id:"cache-size"},"Cache size"),(0,o.kt)("p",null,"Default cache size is 200 entries. You can change it by providing ",(0,o.kt)("inlineCode",{parentName:"p"},"DNS_LOOKUP_CACHE_LIMIT")," environment variable:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"DNS_LOOKUP_CACHE_LIMIT=500\n")))}m.isMDXComponent=!0}}]);